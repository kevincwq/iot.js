// data plot: https://plot.ly/~lizhizhou/2/aapl-stock-prices/#/plot

var LinearRegression = require('shaman').LinearRegression;
var sylvester = require('sylvester'),
    Matrix = sylvester.Matrix,
    Vector = sylvester.Vector,
    _ = require('underscore');
var plotly = require('plotly')('kevincwq', '4r8IwreiJfArsviDSMz4');

const x = ['2012-04-30', '2012-04-29', '2012-04-26', '2012-04-25', '2012-04-24', '2012-04-23', '2012-04-22', '2012-04-19', '2012-04-18', '2012-04-17', '2012-04-16', '2012-04-15', '2012-04-12', '2012-04-11', '2012-04-10', '2012-04-09', '2012-04-08', '2012-04-04', '2012-04-03', '2012-04-02', '2012-04-01', '2012-03-29', '2012-03-28', '2012-03-27', '2012-03-26', '2012-03-25', '2012-03-22', '2012-03-21', '2012-03-20', '2012-03-19', '2012-03-18', '2012-03-15', '2012-03-14', '2012-03-13', '2012-03-12', '2012-03-11', '2012-03-08', '2012-03-07', '2012-03-06', '2012-03-05', '2012-03-04', '2012-03-01', '2012-02-29', '2012-02-28', '2012-02-27', '2012-02-26', '2012-02-23', '2012-02-22', '2012-02-21', '2012-02-20', '2012-02-16', '2012-02-15', '2012-02-14', '2012-02-13', '2012-02-12', '2012-02-09', '2012-02-08', '2012-02-07', '2012-02-06', '2012-02-05', '2012-02-02', '2012-02-01', '2012-01-31', '2012-01-30', '2012-01-29', '2012-01-26', '2012-01-25', '2012-01-24', '2012-01-23', '2012-01-22', '2012-01-19', '2012-01-18', '2012-01-17', '2012-01-16', '2012-01-12', '2012-01-11', '2012-01-10', '2012-01-09', '2012-01-08', '2012-01-05', '2012-01-04', '2012-01-03', '2012-01-02', '2011-12-29', '2011-12-28', '2011-12-27', '2011-12-26', '2011-12-22', '2011-12-21', '2011-12-20', '2011-12-19', '2011-12-18', '2011-12-15', '2011-12-14', '2011-12-13', '2011-12-12', '2011-12-11', '2011-12-08', '2011-12-07', '2011-12-06', '2011-12-05', '2011-12-04', '2011-12-01', '2011-11-30', '2011-11-29', '2011-11-28', '2011-11-27', '2011-11-24', '2011-11-22', '2011-11-21', '2011-11-20', '2011-11-17', '2011-11-16', '2011-11-15', '2011-11-14', '2011-11-13', '2011-11-10', '2011-11-09', '2011-11-08', '2011-11-07', '2011-11-06', '2011-11-03', '2011-11-02', '2011-11-01', '2011-10-31', '2011-10-30', '2011-10-27', '2011-10-26', '2011-10-25', '2011-10-24', '2011-10-23', '2011-10-20', '2011-10-19', '2011-10-18', '2011-10-17', '2011-10-16', '2011-10-13', '2011-10-12', '2011-10-11', '2011-10-10', '2011-10-09', '2011-10-06', '2011-10-05', '2011-10-04', '2011-10-03', '2011-10-02', '2011-09-29', '2011-09-28', '2011-09-27', '2011-09-26', '2011-09-25', '2011-09-22', '2011-09-21', '2011-09-20', '2011-09-19', '2011-09-18', '2011-09-15', '2011-09-14', '2011-09-13', '2011-09-12', '2011-09-11', '2011-09-08', '2011-09-07', '2011-09-06', '2011-09-05', '2011-09-01', '2011-08-31', '2011-08-30', '2011-08-29', '2011-08-28', '2011-08-25', '2011-08-24', '2011-08-23', '2011-08-22', '2011-08-21', '2011-08-18', '2011-08-17', '2011-08-16', '2011-08-15', '2011-08-14', '2011-08-11', '2011-08-10', '2011-08-09', '2011-08-08', '2011-08-07', '2011-08-04', '2011-08-03', '2011-08-02', '2011-08-01', '2011-07-31', '2011-07-28', '2011-07-27', '2011-07-26', '2011-07-25', '2011-07-24', '2011-07-21', '2011-07-20', '2011-07-19', '2011-07-18', '2011-07-17', '2011-07-14', '2011-07-13', '2011-07-12', '2011-07-11', '2011-07-10', '2011-07-07', '2011-07-06', '2011-07-05', '2011-07-04', '2011-06-30', '2011-06-29', '2011-06-28', '2011-06-27', '2011-06-26', '2011-06-23', '2011-06-22', '2011-06-21', '2011-06-20', '2011-06-19', '2011-06-16', '2011-06-15', '2011-06-14', '2011-06-13', '2011-06-12', '2011-06-09', '2011-06-08', '2011-06-07', '2011-06-06', '2011-06-05', '2011-06-02', '2011-06-01', '2011-05-31', '2011-05-30', '2011-05-26', '2011-05-25', '2011-05-24', '2011-05-23', '2011-05-22', '2011-05-19', '2011-05-18', '2011-05-17', '2011-05-16', '2011-05-15', '2011-05-12', '2011-05-11', '2011-05-10', '2011-05-09', '2011-05-08', '2011-05-05', '2011-05-04', '2011-05-03', '2011-05-02', '2011-05-01', '2011-04-28', '2011-04-27', '2011-04-26', '2011-04-25', '2011-04-24', '2011-04-20', '2011-04-19', '2011-04-18', '2011-04-17', '2011-04-14', '2011-04-13', '2011-04-12', '2011-04-11', '2011-04-10', '2011-04-07', '2011-04-06', '2011-04-05', '2011-04-04', '2011-04-03', '2011-03-31', '2011-03-30', '2011-03-29', '2011-03-28', '2011-03-27', '2011-03-24', '2011-03-23', '2011-03-22', '2011-03-21', '2011-03-20', '2011-03-17', '2011-03-16', '2011-03-15', '2011-03-14', '2011-03-13', '2011-03-10', '2011-03-09', '2011-03-08', '2011-03-07', '2011-03-06', '2011-03-03', '2011-03-02', '2011-03-01', '2011-02-28', '2011-02-27', '2011-02-24', '2011-02-23', '2011-02-22', '2011-02-21', '2011-02-17', '2011-02-16', '2011-02-15', '2011-02-14', '2011-02-13', '2011-02-10', '2011-02-09', '2011-02-08', '2011-02-07', '2011-02-06', '2011-02-03', '2011-02-02', '2011-02-01', '2011-01-31', '2011-01-30', '2011-01-27', '2011-01-26', '2011-01-25', '2011-01-24', '2011-01-23', '2011-01-20', '2011-01-19', '2011-01-18', '2011-01-17', '2011-01-13', '2011-01-12', '2011-01-11', '2011-01-10', '2011-01-09', '2011-01-06', '2011-01-05', '2011-01-04', '2011-01-03', '2011-01-02', '2010-12-30', '2010-12-29', '2010-12-28', '2010-12-27', '2010-12-26', '2010-12-22', '2010-12-21', '2010-12-20', '2010-12-19', '2010-12-16', '2010-12-15', '2010-12-14', '2010-12-13', '2010-12-12', '2010-12-09', '2010-12-08', '2010-12-07', '2010-12-06', '2010-12-05', '2010-12-02', '2010-12-01', '2010-11-30', '2010-11-29', '2010-11-28', '2010-11-25', '2010-11-23', '2010-11-22', '2010-11-21', '2010-11-18', '2010-11-17', '2010-11-16', '2010-11-15', '2010-11-14', '2010-11-11', '2010-11-10', '2010-11-09', '2010-11-08', '2010-11-07', '2010-11-04', '2010-11-03', '2010-11-02', '2010-11-01', '2010-10-31', '2010-10-28', '2010-10-27', '2010-10-26', '2010-10-25', '2010-10-24', '2010-10-21', '2010-10-20', '2010-10-19', '2010-10-18', '2010-10-17', '2010-10-14', '2010-10-13', '2010-10-12', '2010-10-11', '2010-10-10', '2010-10-07', '2010-10-06', '2010-10-05', '2010-10-04', '2010-10-03', '2010-09-30', '2010-09-29', '2010-09-28', '2010-09-27', '2010-09-26', '2010-09-23', '2010-09-22', '2010-09-21', '2010-09-20', '2010-09-19', '2010-09-16', '2010-09-15', '2010-09-14', '2010-09-13', '2010-09-12', '2010-09-09', '2010-09-08', '2010-09-07', '2010-09-06', '2010-09-05', '2010-09-02', '2010-09-01', '2010-08-31', '2010-08-30', '2010-08-29', '2010-08-26', '2010-08-25', '2010-08-24', '2010-08-23', '2010-08-22', '2010-08-19', '2010-08-18', '2010-08-17', '2010-08-16', '2010-08-15', '2010-08-12', '2010-08-11', '2010-08-10', '2010-08-09', '2010-08-08', '2010-08-05', '2010-08-04', '2010-08-03', '2010-08-02', '2010-08-01', '2010-07-29', '2010-07-28', '2010-07-27', '2010-07-26', '2010-07-25', '2010-07-22', '2010-07-21', '2010-07-20', '2010-07-19', '2010-07-18', '2010-07-15', '2010-07-14', '2010-07-13', '2010-07-12', '2010-07-11', '2010-07-08', '2010-07-07', '2010-07-06', '2010-07-05', '2010-07-04', '2010-07-01', '2010-06-30', '2010-06-29', '2010-06-28', '2010-06-27', '2010-06-24', '2010-06-23', '2010-06-22', '2010-06-21', '2010-06-20', '2010-06-17', '2010-06-16', '2010-06-15', '2010-06-14', '2010-06-13', '2010-06-10', '2010-06-09', '2010-06-08', '2010-06-07', '2010-06-06', '2010-06-03', '2010-06-02', '2010-06-01', '2010-05-31', '2010-05-30', '2010-05-27', '2010-05-26', '2010-05-25', '2010-05-24', '2010-05-23', '2010-05-20', '2010-05-19', '2010-05-18', '2010-05-17', '2010-05-16', '2010-05-13', '2010-05-12', '2010-05-11', '2010-05-10', '2010-05-09', '2010-05-06', '2010-05-05', '2010-05-04', '2010-05-03', '2010-05-02', '2010-04-29', '2010-04-28', '2010-04-27', '2010-04-26', '2010-04-25', '2010-04-22', '2010-04-21', '2010-04-20', '2010-04-19', '2010-04-18', '2010-04-15', '2010-04-14', '2010-04-13', '2010-04-12', '2010-04-11', '2010-04-08', '2010-04-07', '2010-04-06', '2010-04-05', '2010-04-04', '2010-04-01', '2010-03-31', '2010-03-30', '2010-03-29', '2010-03-28', '2010-03-25', '2010-03-24', '2010-03-23', '2010-03-22', '2010-03-21', '2010-03-18', '2010-03-17', '2010-03-16', '2010-03-15', '2010-03-14', '2010-03-11', '2010-03-10', '2010-03-09', '2010-03-08', '2010-03-07', '2010-03-04', '2010-03-03', '2010-03-02', '2010-03-01', '2010-02-28', '2010-02-25', '2010-02-24', '2010-02-23', '2010-02-22', '2010-02-21', '2010-02-18', '2010-02-17', '2010-02-16', '2010-02-15', '2010-02-14', '2010-02-11', '2010-02-10', '2010-02-09', '2010-02-08', '2010-02-07', '2010-02-04', '2010-02-03', '2010-02-02', '2010-02-01', '2010-01-31', '2010-01-28', '2010-01-27', '2010-01-26', '2010-01-25', '2010-01-24', '2010-01-21', '2010-01-20', '2010-01-19', '2010-01-18', '2010-01-17', '2010-01-14', '2010-01-13', '2010-01-12', '2010-01-11', '2010-01-10', '2010-01-07', '2010-01-06', '2010-01-05', '2010-01-04', '2010-01-03', '2009-12-31', '2009-12-30', '2009-12-29', '2009-12-28', '2009-12-27', '2009-12-24', '2009-12-23', '2009-12-22', '2009-12-21', '2009-12-20', '2009-12-17', '2009-12-16', '2009-12-15', '2009-12-14', '2009-12-13', '2009-12-10', '2009-12-09', '2009-12-08', '2009-12-07', '2009-12-06', '2009-12-03', '2009-12-02', '2009-12-01', '2009-11-30', '2009-11-29', '2009-11-26', '2009-11-25', '2009-11-24', '2009-11-23', '2009-11-22', '2009-11-19', '2009-11-18', '2009-11-17', '2009-11-16', '2009-11-15', '2009-11-12', '2009-11-11', '2009-11-10', '2009-11-09', '2009-11-08', '2009-11-05', '2009-11-04', '2009-11-03', '2009-11-02', '2009-11-01', '2009-10-29', '2009-10-28', '2009-10-27', '2009-10-26', '2009-10-25', '2009-10-22', '2009-10-21', '2009-10-20', '2009-10-19', '2009-10-18', '2009-10-15', '2009-10-14', '2009-10-13', '2009-10-12', '2009-10-11', '2009-10-08', '2009-10-07', '2009-10-06', '2009-10-05', '2009-10-04', '2009-10-01', '2009-09-30', '2009-09-29', '2009-09-28', '2009-09-27', '2009-09-24', '2009-09-23', '2009-09-22', '2009-09-21', '2009-09-20', '2009-09-17', '2009-09-16', '2009-09-15', '2009-09-14', '2009-09-13', '2009-09-10', '2009-09-09', '2009-09-08', '2009-09-07', '2009-09-03', '2009-09-02', '2009-09-01', '2009-08-31', '2009-08-30', '2009-08-27', '2009-08-26', '2009-08-25', '2009-08-24', '2009-08-23', '2009-08-20', '2009-08-19', '2009-08-18', '2009-08-17', '2009-08-16', '2009-08-13', '2009-08-12', '2009-08-11', '2009-08-09', '2009-08-06', '2009-08-05', '2009-08-04', '2009-08-03', '2009-08-02', '2009-07-30', '2009-07-29', '2009-07-28', '2009-07-27', '2009-07-26', '2009-07-23', '2009-07-22', '2009-07-21', '2009-07-20', '2009-07-19', '2009-07-16', '2009-07-15', '2009-07-14', '2009-07-13', '2009-07-12', '2009-07-09', '2009-07-08', '2009-07-07', '2009-07-06', '2009-07-05', '2009-07-02', '2009-07-01', '2009-06-30', '2009-06-29', '2009-06-28', '2009-06-25', '2009-06-24', '2009-06-23', '2009-06-22', '2009-06-21', '2009-06-18', '2009-06-17', '2009-06-16', '2009-06-15', '2009-06-14', '2009-06-11', '2009-06-10', '2009-06-09', '2009-06-08', '2009-06-07', '2009-06-04', '2009-06-03', '2009-06-02', '2009-06-01', '2009-05-31', '2009-05-28', '2009-05-27', '2009-05-26', '2009-05-25', '2009-05-21', '2009-05-20', '2009-05-19', '2009-05-18', '2009-05-17', '2009-05-14', '2009-05-13', '2009-05-12', '2009-05-11', '2009-05-10', '2009-05-07', '2009-05-06', '2009-05-05', '2009-05-04', '2009-05-03', '2009-04-30', '2009-04-29', '2009-04-28', '2009-04-27', '2009-04-26', '2009-04-23', '2009-04-22', '2009-04-21', '2009-04-20', '2009-04-19', '2009-04-16', '2009-04-15', '2009-04-14', '2009-04-13', '2009-04-12', '2009-04-09', '2009-04-08', '2009-04-07', '2009-04-06', '2009-04-05', '2009-04-02', '2009-04-01', '2009-03-31', '2009-03-30', '2009-03-29', '2009-03-26', '2009-03-25', '2009-03-24', '2009-03-23', '2009-03-22', '2009-03-19', '2009-03-18', '2009-03-17', '2009-03-16', '2009-03-15', '2009-03-12', '2009-03-11', '2009-03-10', '2009-03-09', '2009-03-08', '2009-03-05', '2009-03-04', '2009-03-03', '2009-03-02', '2009-03-01', '2009-02-26', '2009-02-25', '2009-02-24', '2009-02-23', '2009-02-22', '2009-02-19', '2009-02-18', '2009-02-17', '2009-02-16', '2009-02-12', '2009-02-11', '2009-02-10', '2009-02-09', '2009-02-08', '2009-02-05', '2009-02-04', '2009-02-03', '2009-02-02', '2009-02-01', '2009-01-29', '2009-01-28', '2009-01-27', '2009-01-26', '2009-01-25', '2009-01-22', '2009-01-21', '2009-01-20', '2009-01-19', '2009-01-15', '2009-01-14', '2009-01-13', '2009-01-12', '2009-01-11', '2009-01-08', '2009-01-07', '2009-01-06', '2009-01-05', '2009-01-04', '2009-01-01', '2008-12-31', '2008-12-30', '2008-12-29', '2008-12-28', '2008-12-25', '2008-12-24', '2008-12-23', '2008-12-22', '2008-12-21', '2008-12-18', '2008-12-17', '2008-12-16', '2008-12-15', '2008-12-14', '2008-12-11', '2008-12-10', '2008-12-09', '2008-12-08', '2008-12-07', '2008-12-04', '2008-12-03', '2008-12-02', '2008-12-01', '2008-11-30', '2008-11-27', '2008-11-26', '2008-11-25', '2008-11-24', '2008-11-23', '2008-11-20', '2008-11-19', '2008-11-18', '2008-11-17', '2008-11-16', '2008-11-13', '2008-11-12', '2008-11-11', '2008-11-10', '2008-11-09', '2008-11-06', '2008-11-05', '2008-11-04', '2008-11-03', '2008-11-02', '2008-10-30', '2008-10-29', '2008-10-28', '2008-10-27', '2008-10-26', '2008-10-23', '2008-10-22', '2008-10-21', '2008-10-20', '2008-10-19', '2008-10-16', '2008-10-15', '2008-10-14', '2008-10-13', '2008-10-12', '2008-10-09', '2008-10-08', '2008-10-07', '2008-10-06', '2008-10-05', '2008-10-02', '2008-10-01'],
    xd = x.map(function (h) {
        return Date.parse(h);
    }),
    y1 = [582.13, 583.98, 603, 607.7, 610, 560.28, 571.7, 572.98, 587.44, 608.34, 609.7, 580.13, 605.23, 622.77, 626.2, 628.44, 636.23, 633.68, 624.31, 629.32, 618.63, 599.55, 609.86, 617.62, 614.48, 606.98, 596.05, 599.34, 602.5, 605.96, 601.1, 585.57, 585.56, 589.58, 568.1, 552, 545.17, 541.99, 530.69, 530.26, 533.16, 545.18, 544.47, 542.44, 535.41, 525.76, 522.41, 516.39, 513.04, 514.85, 502.12, 502.21, 497.67, 509.46, 502.6, 493.42, 493.17, 476.68, 468.83, 463.97, 459.68, 455.12, 456.19, 456.48, 453.01, 447.28, 444.63, 446.66, 420.41, 427.41, 420.3, 427.75, 429.11, 424.7, 419.81, 421.39, 422.55, 423.24, 421.73, 422.4, 418.03, 413.44, 411.23, 405, 405.12, 402.64, 406.53, 403.43, 398.55, 396.44, 395.95, 382.21, 381.02, 378.94, 380.19, 388.81, 391.84, 393.62, 390.66, 389.09, 390.95, 393.01, 389.7, 387.93, 382.2, 373.2, 376.12, 363.57, 366.99, 376.51, 369.01, 374.94, 377.41, 384.77, 388.83, 379.26, 384.62, 385.22, 395.28, 406.23, 399.73, 400.24, 403.07, 397.41, 396.51, 404.78, 404.95, 404.69, 400.6, 397.77, 405.77, 392.87, 395.31, 398.62, 422.24, 419.99, 422, 408.43, 402.19, 400.29, 388.81, 369.8, 377.37, 378.25, 372.5, 374.6, 381.32, 390.57, 397.01, 399.26, 403.17, 404.3, 401.82, 412.14, 413.45, 411.63, 400.5, 392.96, 389.3, 384.62, 379.94, 377.48, 384.14, 383.93, 379.74, 374.05, 381.03, 384.83, 389.99, 389.97, 383.58, 373.72, 376.18, 373.6, 356.44, 356.03, 366.05, 380.44, 380.48, 383.41, 376.99, 373.7, 363.69, 374.01, 353.21, 373.62, 377.37, 392.57, 388.91, 396.75, 390.48, 391.82, 392.59, 403.41, 398.5, 393.3, 387.29, 386.9, 376.85, 373.8, 364.92, 357.77, 358.02, 353.75, 354, 359.71, 357.2, 351.76, 349.43, 343.26, 335.67, 334.04, 335.26, 332.04, 326.35, 331.23, 322.61, 325.3, 315.32, 320.26, 325.16, 326.75, 332.44, 326.6, 325.9, 331.49, 332.24, 332.04, 338.04, 343.44, 346.1, 345.51, 347.83, 337.41, 335, 336.78, 332.19, 334.4, 335.22, 340.53, 339.87, 336.14, 333.3, 340.5, 346.57, 347.23, 349.45, 347.6, 346.66, 346.75, 349.57, 348.2, 346.28, 350.13, 346.75, 350.15, 350.42, 353.01, 350.7, 342.41, 337.86, 331.85, 327.46, 332.42, 336.13, 332.4, 330.8, 335.06, 338.08, 338.04, 338.89, 341.19, 344.56, 348.51, 348.63, 350.96, 350.44, 351.54, 344.97, 339.19, 341.2, 339.3, 330.67, 334.64, 330.01, 345.43, 353.56, 351.99, 346.67, 352.47, 355.76, 355.36, 360, 359.56, 352.12, 349.31, 353.21, 348.16, 342.88, 342.62, 338.61, 350.56, 358.3, 363.13, 359.9, 359.18, 356.85, 354.54, 358.16, 355.2, 351.88, 346.5, 343.44, 344.32, 345.03, 339.32, 336.1, 343.21, 343.85, 341.4, 337.45, 326.72, 332.68, 338.84, 340.65, 348.48, 345.68, 344.42, 341.64, 342.46, 336.12, 333.73, 334, 331.29, 329.57, 322.56, 323.66, 325.29, 325.47, 324.68, 323.6, 325.16, 324.2, 322.21, 320.61, 321.25, 320.36, 320.29, 321.67, 320.56, 319.76, 321.01, 318.21, 320.15, 317.44, 318.15, 316.4, 311.15, 316.87, 315, 314.8, 308.73, 313.36, 306.73, 308.43, 300.5, 301.59, 307.04, 308.03, 316.66, 318.03, 316.08, 318.62, 317.13, 318.27, 312.8, 309.36, 304.18, 300.98, 305.24, 307.83, 308.05, 308.84, 307.47, 309.52, 310.53, 309.49, 318, 314.74, 302.31, 300.14, 298.54, 295.36, 294.07, 289.22, 289.19, 288.94, 278.64, 282.52, 283.75, 287.37, 286.86, 291.16, 292.32, 288.92, 287.75, 283.77, 283.23, 275.37, 276.57, 270.22, 268.06, 267.04, 263.41, 263.07, 262.92, 257.81, 258.77, 258.77, 252.17, 250.33, 243.1, 242.5, 241.62, 240.28, 242.89, 239.93, 245.8, 249.64, 249.88, 253.07, 251.97, 247.64, 249.1, 251.79, 250.19, 259.41, 261.75, 260.09, 261.7, 262.98, 261.93, 261.85, 257.25, 258.11, 260.96, 264.08, 259.28, 259.94, 259.02, 254.24, 251.89, 245.58, 249.9, 251.45, 252.73, 251.8, 257.28, 259.62, 258.09, 258.66, 248.63, 246.94, 246.94, 248.48, 251.53, 256.17, 268.3, 266.7, 269, 270.97, 273.85, 270.17, 274.07, 271.87, 267.25, 259.69, 254.28, 253.51, 250.51, 243.2, 249.33, 250.94, 255.96, 263.12, 263.95, 260.83, 256.88, 256.88, 253.35, 244.11, 245.22, 246.76, 242.32, 237.76, 248.34, 252.36, 254.22, 253.82, 258.36, 262.09, 256.52, 253.99, 235.86, 246.25, 255.98, 258.68, 266.35, 261.09, 268.64, 261.6, 262.04, 269.5, 270.83, 266.47, 259.22, 244.59, 247.07, 247.4, 248.92, 245.69, 242.43, 242.29, 241.79, 239.95, 240.6, 239.54, 238.49, 235.97, 235.97, 235, 235.84, 232.39, 230.9, 226.65, 229.37, 228.36, 224.75, 222.25, 224.65, 224.12, 224.45, 223.84, 226.6, 225.5, 224.84, 223.02, 219.08, 218.95, 210.71, 209.33, 208.85, 208.99, 204.62, 202, 200.66, 197.06, 200.42, 201.67, 202.93, 202.55, 203.4, 200.38, 200.38, 198.67, 195.12, 196.19, 194.12, 195.46, 192.05, 199.23, 195.86, 194.73, 192.06, 199.29, 207.88, 205.94, 203.08, 197.75, 208.07, 211.72, 215.04, 205.93, 205.93, 209.43, 210.65, 207.72, 210.11, 211.98, 210.58, 210.97, 214.38, 214.01, 210.73, 210.73, 211.64, 209.1, 211.61, 209.04, 209.04, 202.1, 200.36, 198.23, 195.43, 191.86, 195.03, 194.17, 196.98, 194.67, 196.43, 197.8, 189.87, 188.95, 193.32, 196.48, 196.23, 196.97, 199.91, 200.59, 204.19, 204.19, 204.44, 205.88, 199.92, 200.51, 205.96, 207, 206.63, 204.45, 201.99, 203.25, 202.98, 201.46, 194.34, 194.03, 190.81, 188.75, 189.31, 188.5, 196.35, 192.4, 197.37, 202.48, 203.94, 205.2, 204.92, 198.76, 189.86, 188.05, 190.56, 191.29, 190.02, 190.81, 190.47, 189.27, 190.25, 190.01, 186.02, 184.9, 180.86, 185.35, 185.38, 186.15, 182.37, 183.82, 185.5, 184.48, 184.02, 185.02, 184.55, 181.87, 175.16, 173.72, 172.16, 172.56, 171.14, 172.93, 170.31, 166.55, 165.18, 165.3, 168.21, 170.05, 169.45, 167.41, 169.4, 169.06, 169.22, 166.33, 164.6, 164, 159.59, 166.78, 168.42, 165.31, 164.72, 165.51, 163.91, 165.11, 165.55, 166.43, 163.39, 162.79, 160.03, 160, 160.1, 159.99, 157.82, 156.74, 151.51, 152.91, 151.75, 147.52, 146.88, 142.27, 142.34, 138.52, 136.36, 137.22, 135.4, 138.61, 140.02, 140.02, 142.83, 142.43, 141.97, 142.44, 139.86, 136.22, 134.01, 137.37, 139.48, 135.88, 135.58, 136.35, 136.09, 136.97, 139.95, 140.25, 142.72, 143.85, 144.67, 143.74, 140.95, 139.49, 139.35, 135.81, 135.07, 133.05, 130.78, 122.5, 124.18, 125.87, 127.45, 126.65, 122.42, 122.95, 119.49, 124.42, 129.57, 129.19, 129.06, 132.5, 132.71, 132.07, 127.24, 125.83, 125.14, 123.9, 124.73, 123.9, 125.4, 121.51, 121.76, 120.5, 123.42, 121.45, 117.64, 118.31, 120.22, 119.57, 119.57, 116.32, 115, 118.45, 115.99, 112.71, 108.69, 105.12, 104.49, 106.85, 109.87, 106.49, 106.5, 107.66, 101.59, 101.62, 101.52, 99.66, 95.42, 95.93, 96.35, 92.68, 88.63, 83.11, 85.3, 88.84, 91.17, 88.37, 87.94, 89.31, 89.19, 91.16, 90.25, 86.95, 91.2, 90.64, 94.37, 94.53, 99.16, 99.27, 96.82, 97.83, 102.51, 99.72, 96.46, 93.55, 92.98, 91.51, 90.13, 93, 94.2, 90.73, 89.64, 88.36, 88.36, 82.83, 78.2, 82.33, 83.38, 85.33, 87.71, 88.66, 90.58, 92.7, 91.01, 93.02, 94.58, 90.75, 85.35, 85.35, 86.29, 86.61, 85.81, 85.04, 85.04, 86.38, 85.74, 90, 89.43, 89.16, 95.43, 94.75, 98.27, 95, 98.21, 100.06, 99.72, 94, 91.41, 95.9, 92.47, 88.93, 92.67, 95, 95, 90.8, 92.95, 82.58, 80.49, 86.29, 89.91, 88.14, 90.24, 96.44, 90.12, 94.77, 95.88, 98.24, 99.1, 103.3, 110.99, 106.96, 107.59, 111.04, 104.55, 99.91, 92.09, 96.38, 98.23, 96.87, 91.49, 98.44, 97.4, 101.89, 97.95, 104.08, 110.26, 96.8, 88.74, 89.79, 89.16, 98.14, 97.07, 100.1],
    y2 = [];


LinearRegression.prototype.gradientDescent = function (X, Y, theta, learningRate, numberOfIterations) {
    var m = Y.dimensions().rows;
    var nbrOfFeatures = X.dimensions().cols;
    var normalizedX = this.normalize(X);
    for (var i = 0; i < numberOfIterations; i++) {
        // Y - theta * X
        var xThetaMinusY = (normalizedX.x(theta)).subtract(Y);
        var tempArray = [];
        for (var j = 1; j <= nbrOfFeatures; j++) {
            var xThetaMinusYTimesXj = xThetaMinusY.transpose().x(normalizedX.column(j));
            var arrayToSum = _.flatten(xThetaMinusYTimesXj.elements);
            var sum = _.reduce(arrayToSum, function (memo, num) {
                return memo + num;
            }, 0);
            var temp = theta.e(j, 1) - (learningRate / m) * sum;
            tempArray.push([temp]);
        }
        theta = $M(tempArray);
        if (this.saveCosts) {
            this.costs.push(LinearRegression.computeCost(normalizedX, Y, theta));
        }
        if (true) {
            console.log('Iteration: ', i, ' -> Cost: ', LinearRegression.computeCost(normalizedX, Y, theta));
        }
    }
    return theta;
}

var lr = new LinearRegression(xd, y1, {
    algorithm: 'GradientDescent',
    learningRate: 0.1,
    numberOfIterations: 1000
});

lr.train(function (err) {
    if (err) {
        console.log('error', err);
        process.exit(2);
    }

    xd.forEach(function (xi) {
        y2.push(lr.predict(xi));
    });
});

// You can reproduce this figure in node.js with the following code!

// Learn about API authentication here: https://plot.ly/nodejs/getting-started
// Find your api_key here: https://plot.ly/settings/api

trace1 = {
    x: x,
    y: y1,
    mode: 'lines',
    name: 'Training Data',
    type: 'scatter'
};
trace2 = {
    x: x,
    y: y2,
    mode: 'lines',
    name: 'Linear Regression',
    type: 'scatter'
};

layout = {
    title: 'AAPL Stock Prices',
    xaxis: {
        title: 'Date'
    },
    yaxis: {
        title: 'Price in $'
    }
};

plotly.plot([trace1, trace2], {
    layout: layout,
    filename: "aapl-stock-linear-regression-with-shaman",
    fileopt: "overwrite"
}, function (err, msg) {
    console.log(msg);
});

// https://plot.ly/~kevincwq/4